@{
    ViewBag.Title = "Checkout";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- 🏷️ Payment Method & Status (Initially Hidden) -->
<div class="container mt-4">
    <div class="card shadow p-4" style="max-width: 600px; margin: auto;">
        <h3 class="text-center text-success">🛒 Checkout</h3>
        <p><strong>Invoice #:</strong> <span id="invoiceID">@ViewBag.InvoiceID</span></p>
        <p><strong>Customer Name:</strong> <span id="customerName">@ViewBag.CustomerName</span></p>
        <p><strong>Total Amount:</strong> <span id="totalAmount">@ViewBag.TotalAmount</span> PKR</p>

        <h5 class="mt-3">💳 Select Payment Method</h5>
        <select id="paymentMethod" class="form-control">
            <option value="COD">Cash on Delivery</option>
            <option value="Bank">Bank Transfer</option>
            <option value="Delayed">Delayed Payment</option>
        </select>

        <div id="bankDetails" class="mt-3 d-none">
            <label>🏦 Enter Bank Transaction Number:</label>
            <input type="text" id="bankTransactionNumber" class="form-control" placeholder="Enter transaction ID">
        </div>

        <button class="btn btn-primary w-100 mt-3" id="confirmPayment">✅ Confirm Payment</button>
    </div>
</div>

<script>
    $(document).ready(function () {
        $("#paymentMethod").change(function () {
            if ($(this).val() === "Bank") {
                $("#bankDetails").removeClass("d-none");
            } else {
                $("#bankDetails").addClass("d-none");
            }
        });

        $("#confirmPayment").click(function () {
            var invoiceID = $("#invoiceID").text();
            var customerName = $("#customerName").text();
            var totalAmount = $("#totalAmount").text();
            var paymentMethod = $("#paymentMethod").val();
            var bankTransactionNumber = $("#bankTransactionNumber").val();


            $.ajax({
                url: '/Cart/ConfirmPayment',
                type: 'POST',
                data: {
                    InvoiceID: invoiceID,
                    CustomerName: customerName,
                    TotalAmount: totalAmount,
                    PaymentMethod: paymentMethod,
                    BankTransactionNumber: bankTransactionNumber
                },
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Payment Successful!',
                            text: 'Your payment has been processed successfully.'
                        }).then(() => {
                            window.location.href = '/Invoice/Receipt/' + invoiceID;
                          
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Payment Failed',
                            text: 'Something went wrong! Try again.'
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Server error! Please try again later.'
                    });
                }
            });
        });
    });
</script>
